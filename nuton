#include <stdio.h>
#include <math.h>

#define MAX_ITER 100
#define EPS 1e-6

// первое уравнение
double f1(double x, double y) {
    return x * x * x + y * y * y - 8.0;
}
// второе уравнение
double f2(double x, double y) {
    return y - x * x - 1.0;
}
// матрица якоби матрица производных
void jacobian(double x, double y, double J[2][2]) {
    J[0][0] = 3.0 * x * x;
    J[0][1] = 3.0 * y * y;
    J[1][0] = -2.0 * x;
    J[1][1] = 1.0;
}
// решение системы
int solve_system(double A[2][2], double b[2], double x[2]) {
    double det = A[0][0] * A[1][1] - A[0][1] * A[1][0];// детерминант 

    if (fabs(det) < 0) {
        printf("Матрица вырождена, det = %.2e\n", det);
        return 0;
    }

    double inv_det = 1.0 / det;// обратный дет 
    x[0] = (b[0] * A[1][1] - A[0][1] * b[1]) * inv_det;// заменяем 1 столбец на b
    x[1] = (A[0][0] * b[1] - b[0] * A[1][0]) * inv_det;// заменяем 2 столбец на b

    return 1;
}

int newton(double x0, double y0, double* x_sol, double* y_sol) {
    double x = x0;
    double y = y0;
    double J[2][2], F[2], delta[2];

    printf("  n |      x      |      y      |    |f1|    |    |f2|    \n");
    printf("----|-------------|-------------|-------------|-------------\n");

    for (int iter = 0; iter < MAX_ITER; iter++) {
        F[0] = f1(x, y);
        F[1] = f2(x, y);

        printf("%3d | %11.8f | %11.8f | %11.2e | %11.2e\n",
            iter, x, y, fabs(F[0]), fabs(F[1]));

        if (fabs(F[0]) < EPS && fabs(F[1]) < EPS) {
            printf("\nДостигнута точность на итерации %d\n", iter);
            *x_sol = x;
            *y_sol = y;
            return 1;
        }

        jacobian(x, y, J);

        double rhs[2] = { -F[0], -F[1] };

        if (!solve_system(J, rhs, delta)) {
            printf("\nОшибка: система не решается\n");
            return 0;
        }

        x += delta[0];
        y += delta[1];
    }

    printf("\nНе сошлось за %d итераций\n", MAX_ITER);
    *x_sol = x;
    *y_sol = y;
    return 0;
}

int main() {
    double x_sol, y_sol;

    if (newton(1.0, 2.0, &x_sol, &y_sol)) {
        printf("\nРешение: x = %.10f, y = %.10f\n", x_sol, y_sol);
        printf("Проверка:\n");
        printf("  f1(x,y) = %.2e\n", f1(x_sol, y_sol));
        printf("  f2(x,y) = %.2e\n", f2(x_sol, y_sol));
    }

    return 0;
}
