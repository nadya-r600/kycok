#include <stdio.h>
#include <math.h>

const int n = 10;

// Функции численного дифференцирования
double right_dif(double x[], double y[], int i, double h) {
    return (y[i + 1] - y[i]) / h;
}

double left_dif(double x[], double y[], int i, double h) {
    return (y[i] - y[i - 1]) / h;
}

double central_dif(double x[], double y[], int i, double h) {
    return (y[i + 1] - y[i - 1]) / (2 * h);
}

double second(double x[], double y[], int i, double h) {
    return (y[i + 1] - 2 * y[i] + y[i - 1]) / (h * h);
}

double three(double x[], double y[], int i, double h) {
    return (-y[i + 2] + 4 * y[i + 1] - 3 * y[i]) / (2 * h);
}

int main() {

    double x[] = { 0.1, 0.5, 0.9, 1.3 };
    double y[] = { 0.3987, 0.7894, 1.1646, 1.5174};

    int n = sizeof(x) / sizeof(x[0]);
    double h = x[1] - x[0];


    printf("h = %.6f\n\n", h);

    // Вывод таблицы точек
    printf("i\tx_i\t\ty_i\n");
    printf("--------------------------------\n");
    for (int i = 0; i < n; i++) {
        printf("%d\t%.6f\t%.6f\n", i, x[i], y[i]);
    }
    printf("\n");

    // Вычисление производных для всех возможных точек
    printf("results\n");
    printf("=================================================================================================\n");
    printf("i\tx_i\t\tright f'\tleft f'\t        centr. f'\tthree. f'\tf''\n");
    printf("-------------------------------------------------------------------------------------------------\n");

    for (int i = 0; i < n; i++) {
        printf("%d\t%.6f", i, x[i]);

        // Правая разностная производная (для i = 0..n-2)
        if (i < n - 1) {
            printf("\t%.6f", right_dif(x, y, i, h));
        }
        else {
            printf("\t--------");
        }

        // Левая разностная производная (для i = 1..n-1)
        if (i > 0) {
            printf("\t%.6f", left_dif(x, y, i, h));
        }
        else {
            printf("\t--------");
        }

        // Центральная разностная производная (для i = 1..n-2)
        if (i > 0 && i < n - 1) {
            printf("\t%.6f", central_dif(x, y, i, h));
        }
        else {
            printf("\t--------");
        }

        // Трехточечная производная (для i = 0..n-3)
        if (i < n - 2) {
            printf("\t%.6f", three(x, y, i, h));
        }
        else {
            printf("\t--------");
        }

        // Вторая производная (для i = 1..n-2)
        if (i > 0 && i < n - 1) {
            printf("\t%.6f", second(x, y, i, h));
        }
        else {
            printf("\t--------");
        }

        printf("\n");
    }

    // Детальный анализ для конкретной точки (x=3)
    int selected_i = 2; // точка x=3
    printf("\n x_%d = %.6f, y_%d = %.6f:\n",
        selected_i, x[selected_i], selected_i, y[selected_i]);
    printf("\n");

    if (selected_i < n - 1) {
        printf("right:  f'(x_%d) = (y_%d - y_%d)/h = (%.6f - %.6f)/%.6f = %.6f\n",
            selected_i, selected_i + 1, selected_i,
            y[selected_i + 1], y[selected_i], h,
            right_dif(x, y, selected_i, h));
    }

    if (selected_i > 0) {
        printf("left:   f'(x_%d) = (y_%d - y_%d)/h = (%.6f - %.6f)/%.6f = %.6f\n",
            selected_i, selected_i, selected_i - 1,
            y[selected_i], y[selected_i - 1], h,
            left_dif(x, y, selected_i, h));
    }

    if (selected_i > 0 && selected_i < n - 1) {
        printf("center: f'(x_%d) = (y_%d - y_%d)/(2h) = (%.6f - %.6f)/(2*%.6f) = %.6f\n",
            selected_i, selected_i + 1, selected_i - 1,
            y[selected_i + 1], y[selected_i - 1], h,
            central_dif(x, y, selected_i, h));

        printf("second: f''(x_%d) = (y_%d - 2y_%d + y_%d)/h² = (%.6f - 2*%.6f + %.6f)/%.6f = %.6f\n",
            selected_i, selected_i + 1, selected_i, selected_i - 1,
            y[selected_i + 1], y[selected_i], y[selected_i - 1], h * h,
            second(x, y, selected_i, h));
    }

    if (selected_i < n - 2) {
        printf("three:      f'(x_%d) = (-y_%d + 4y_%d - 3y_%d)/(2h) = (-%.6f + 4*%.6f - 3*%.6f)/(2*%.6f) = %.6f\n",
            selected_i, selected_i + 2, selected_i + 1, selected_i,
            y[selected_i + 2], y[selected_i + 1], y[selected_i], h,
            three(x, y, selected_i, h));
    }

}
}
