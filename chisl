#include <stdio.h>

// Функция кусочно-линейной интерполяции
double linear_interpolation(double x[], double y[], int n, double target_x) {
    // Проверка границ
    if (target_x <= x[0]) {
        return y[0];
    }
    if (target_x >= x[n - 1]) {
        return y[n - 1];
    }

    // Поиск интервала, содержащего target_x
    int i = 0;
    while (i < n - 1 && target_x > x[i + 1]) {
        i++;
    }

    // Линейная интерполяция на найденном интервале
    double x0 = x[i];
    double x1 = x[i + 1];
    double y0 = y[i];
    double y1 = y[i + 1];

    return y0 + (y1 - y0) * (target_x - x0) / (x1 - x0);
}

int main() {
    // Данные из таблицы
    double x[] = { 0.1, 0.2, 0.4 };
    double y[] = { 10.0, 5.0, 2.5 };
    int n = sizeof(x) / sizeof(x[0]);
    double t_x = 0.25;

    printf("piecewise linear interpolation\n");
    
    // Вывод исходных данных
    printf("x\t\ty\n");
    printf("-------------------\n");
    for (int i = 0; i < n; i++) {
        printf("%.1f\t\t%.1f\n", x[i], y[i]);
    }
    printf("\n");

    // Поиск интервала для x = 0.25
    int i = 0;
    while (i < n - 1 && t_x > x[i + 1]) {
        i++;
    }

    printf("x = %.2f:\n", t_x);
    printf("interval: [%.1f, %.1f]\n", x[i], x[i + 1]);
    printf("points: (%.1f, %.1f) and (%.1f, %.1f)\n",
        x[i], y[i], x[i + 1], y[i + 1]);

    // Вычисление интерполяции
    double x0 = x[i], x1 = x[i + 1];
    double y0 = y[i], y1 = y[i + 1];
    double result = linear_interpolation(x, y, n, t_x);

    printf("\nformula:\n");
    printf("y = y0 + (y1 - y0) * (x - x0) / (x1 - x0)\n");
    printf("y = %.1f + (%.1f - %.1f) * (%.2f - %.1f) / (%.1f - %.1f)\n",
        y0, y1, y0, t_x, x0, x1, x0);

    printf("1. (y1 - y0) = %.1f - %.1f = %.1f\n", y1, y0, y1 - y0);
    printf("2. (x - x0) = %.2f - %.1f = %.2f\n", t_x, x0, t_x - x0);
    printf("3. (x1 - x0) = %.1f - %.1f = %.1f\n", x1, x0, x1 - x0);
    printf("4. (y1 - y0) * (x - x0) / (x1 - x0) = %.1f * %.2f / %.1f = %.3f\n",
        y1 - y0, t_x - x0, x1 - x0, (y1 - y0) * (t_x - x0) / (x1 - x0));
    printf("5. y = %.1f + %.3f = %.3f\n", y0, (y1 - y0) * (t_x - x0) / (x1 - x0), result);

    printf("\nresults: f(%.2f) = %.3f\n", t_x, result);

}
