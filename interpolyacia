#include <stdio.h>
#include <math.h>

const int a = 10;

// Функция для вычисления факториала
double factorial(int n) {
    double result = 1.0;
    for (int i = 2; i <= n; i++) {
        result *= i;
    }
    return result;
}

// Функция для вычисления конечных разностей
void compute_differences(double y[], double diff[][a], int n) {
    // Первые разности
    for (int i = 0; i < n - 1; i++) {
        diff[0][i] = y[i + 1] - y[i];
    }

    // Последующие разности
    for (int k = 1; k < n - 1; k++) {
        for (int i = 0; i < n - k - 1; i++) {
            diff[k][i] = diff[k - 1][i + 1] - diff[k - 1][i];
        }
    }
}

// Первая интерполяционная формула Ньютона
double newton_first_interpolation(double x0, double y[], double diff[][a], int n, double h) {
    double q = (x0 - 2.0) / h; // x0 = 2 - начальный узел

    double result = y[0];
    double term = q;

    for (int k = 1; k < n; k++) {
        result += term * diff[k - 1][0] / factorial(k);
        term *= (q - k);
    }

    return result;
}

int main() {
    double x[] = { 2, 4, 6, 8, 10 }; // узлы интерполяции
    int n = sizeof(x) / sizeof(x[0]);
    double h = x[1] - x[0]; // шаг

    printf("x =: ");
    for (int i = 0; i < n; i++) {
        printf("%.0f ", x[i]);
    }
    printf("\nh = %.0f\n\n", h);

    // Функция 1: y = 1/x
    printf("function 1: y = 1/x\n");

    double y1[a];

    printf("i\tx_i\ty_i\n");
    printf("------------------------\n");
    for (int i = 0; i < n; i++) {
        y1[i] = 1.0 / x[i];
        printf("%d\t%.0f\t%.6f\n", i, x[i], y1[i]);
    }

    // Вычисление конечных разностей для функции 1
    double diff1[a][a] = { 0 };
    compute_differences(y1, diff1, n);

    printf("i\tx_i\ty_i\t");
    for (int k = 1; k < n; k++) {
        printf("%dy\t", k);
    }
    printf("\n");
    printf("------------------------------------------------------------\n");

    for (int i = 0; i < n; i++) {
        printf("%d\t%.0f\t%.6f\t", i, x[i], y1[i]);
        for (int k = 1; k < n - i; k++) {
            printf("%.6f\t", diff1[k - 1][i]);
        }
        for (int k = n - i; k < n; k++) {
            printf(" \t");
        }
        printf("\n");
    }

    // Подстановка в формулу Ньютона для функции 1
    printf("P(x) = y0");
    for (int k = 1; k < n; k++) {
        printf(" + [q...(q-%d)/%d!]y^%d", k-1, k, k);
    }
    printf("\n\n");
    

    printf("P(x) = %.6f", y1[0]);
    for (int k = 1; k < n; k++) {
        printf(" + [q(q-1)...(q-%d)/%d!]·%.6f", k-1, k, diff1[k-1][0]);
    }
    printf("\n");

    
    // Функция 2: y = x^4
    printf("\n\n2: y = x^4\n");
    printf("==================\n");

    double y2[a];
    printf("i\tx_i\ty_i\n");
    printf("------------------------\n");
    for (int i = 0; i < n; i++) {
        y2[i] = pow(x[i], 4);
        printf("%d\t%.0f\t%.0f\n", i, x[i], y2[i]);
    }

    // Вычисление конечных разностей для функции 2
    double diff2[a][a] = { 0 };
    compute_differences(y2, diff2, n);

    printf("i\tx_i\ty_i\t");
    for (int k = 1; k < n; k++) {
        printf("%dy\t", k);
    }
    printf("\n");
    printf("------------------------------------------------------------\n");

    for (int i = 0; i < n; i++) {
        printf("%d\t%.0f\t%.0f\t", i, x[i], y2[i]);
        for (int k = 1; k < n - i; k++) {
            printf("%.0f\t", diff2[k - 1][i]);
        }
        for (int k = n - i; k < n; k++) {
            printf("----\t");
        }
        printf("\n");
    }

    // Подстановка в формулу Ньютона для функции 2

    printf("P(x) = y0");
    for (int k = 1; k < n; k++) {
        printf(" + [q...(q-%d)/%d!]y^%d", k - 1, k, k);
    }
    printf("\n\n");

    printf("P(x) = %.0f", y2[0]);
    for (int k = 1; k < n; k++) {
        printf(" + [q(q-1)...(q-%d)/%d!]·%.0f", k-1, k, diff2[k-1][0]);

    }
    printf("\n");

   
}
