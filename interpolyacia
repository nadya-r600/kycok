#include <stdio.h>
#include <math.h>

#define MAX_N 10

// Функция для вычисления факториала
double factorial(int n) {
    double result = 1.0;
    for (int i = 2; i <= n; i++) {
        result *= i;
    }
    return result;
}

// Функция для вычисления конечных разностей
void compute_differences(double y[], double diff[][MAX_N], int n) {
    // Первые разности
    for (int i = 0; i < n-1; i++) {
        diff[0][i] = y[i+1] - y[i];
    }
    
    // Последующие разности
    for (int k = 1; k < n-1; k++) {
        for (int i = 0; i < n-k-1; i++) {
            diff[k][i] = diff[k-1][i+1] - diff[k-1][i];
        }
    }
}

// Первая интерполяционная формула Ньютона
double newton_first_interpolation(double x0, double y[], double diff[][MAX_N], int n, double h) {
    double q = (x0 - 2.0) / h; // x0 = 2 - начальный узел
    
    double result = y[0];
    double term = q;
    
    for (int k = 1; k < n; k++) {
        result += term * diff[k-1][0] / factorial(k);
        term *= (q - k);
    }
    
    return result;
}

int main() {
    double x[] = {2, 4, 6, 8, 10}; // узлы интерполяции
    int n = sizeof(x) / sizeof(x[0]);
    double h = x[1] - x[0]; // шаг
    
    printf("ПЕРВАЯ ИНТЕРПОЛЯЦИОННАЯ ФОРМУЛА НЬЮТОНА\n");
    printf("=======================================\n\n");
    
    printf("Равноотстоящие узлы: ");
    for (int i = 0; i < n; i++) {
        printf("%.0f ", x[i]);
    }
    printf("\nШаг h = %.0f\n\n", h);
    
    // Функция 1: y = 1/x
    printf("ФУНКЦИЯ 1: y = 1/x\n");
    printf("==================\n");
    
    double y1[MAX_N];
    printf("\nЗначения функции в узлах:\n");
    printf("i\tx_i\ty_i = 1/x_i\n");
    printf("------------------------\n");
    for (int i = 0; i < n; i++) {
        y1[i] = 1.0 / x[i];
        printf("%d\t%.0f\t%.6f\n", i, x[i], y1[i]);
    }
    
    // Вычисление конечных разностей для функции 1
    double diff1[MAX_N][MAX_N] = {0};
    compute_differences(y1, diff1, n);
    
    printf("\nТаблица конечных разностей для y = 1/x:\n");
    printf("i\tx_i\ty_i\t");
    for (int k = 1; k < n; k++) {
        printf("Δ^%dy\t", k);
    }
    printf("\n");
    printf("------------------------------------------------------------\n");
    
    for (int i = 0; i < n; i++) {
        printf("%d\t%.0f\t%.6f\t", i, x[i], y1[i]);
        for (int k = 1; k < n-i; k++) {
            printf("%.6f\t", diff1[k-1][i]);
        }
        for (int k = n-i; k < n; k++) {
            printf("  --\t");
        }
        printf("\n");
    }
    
    // Интерполяция для функции 1
    printf("\nИнтерполяция для y = 1/x:\n");
    printf("x\t\tТочное y\n");
    printf("-----------------------\n");
    
    double test_points[] = {3, 5, 7, 9, 2.5, 4.5, 6.5, 8.5};
    int num_test = sizeof(test_points) / sizeof(test_points[0]);
    
    for (int i = 0; i < num_test; i++) {
        double x0 = test_points[i];
        double exact = 1.0 / x0;
        double interpolated = newton_first_interpolation(x0, y1, diff1, n, h);
        
        printf("%.1f\t\t%.6f\n", x0, interpolated);
    }
    
    // Функция 2: y = x^4
    printf("\n\nФУНКЦИЯ 2: y = x^4\n");
    printf("==================\n");
    
    double y2[MAX_N];
    printf("\nЗначения функции в узлах:\n");
    printf("i\tx_i\ty_i = x_i^4\n");
    printf("------------------------\n");
    for (int i = 0; i < n; i++) {
        y2[i] = pow(x[i], 4);
        printf("%d\t%.0f\t%.0f\n", i, x[i], y2[i]);
    }
    
    // Вычисление конечных разностей для функции 2
    double diff2[MAX_N][MAX_N] = {0};
    compute_differences(y2, diff2, n);
    
    printf("\nТаблица конечных разностей для y = x^4:\n");
    printf("i\tx_i\ty_i\t");
    for (int k = 1; k < n; k++) {
        printf("Δ^%dy\t", k);
    }
    printf("\n");
    printf("------------------------------------------------------------\n");
    
    for (int i = 0; i < n; i++) {
        printf("%d\t%.0f\t%.0f\t", i, x[i], y2[i]);
        for (int k = 1; k < n-i; k++) {
            printf("%.0f\t", diff2[k-1][i]);
        }
        for (int k = n-i; k < n; k++) {
            printf("  --\t");
        }
        printf("\n");
    }
    
    // Интерполяция для функции 2
    printf("\nИнтерполяция для y = x^4:\n");
    printf("x\t\tТочное y\n");
    printf("-----------------------\n");
    
    for (int i = 0; i < num_test; i++) {
        double x0 = test_points[i];
        double exact = pow(x0, 4);
        double interpolated = newton_first_interpolation(x0, y2, diff2, n, h);
        
        printf("%.1f\t\t%.1f\n", x0, interpolated);
    }
    
    // Демонстрация вычисления интерполяционного многочлена для функции 1
    printf("\n\nДЕМОНСТРАЦИЯ ВЫЧИСЛЕНИЯ ФОРМУЛЫ НЬЮТОНА\n");
    printf("======================================\n");
    
    printf("\nДля функции y = 1/x в точке x = 5:\n");
    double x_demo = 5.0;
    double q = (x_demo - 2.0) / h;
    
    printf("q = (x - x0)/h = (5 - 2)/2 = %.1f\n", q);
    printf("\nP(5) = y0");
    
    double result = y1[0];
    double term = q;
    
    printf(" = %.6f\n", y1[0]);
    
    for (int k = 1; k < n; k++) {
        double coeff = term / factorial(k);
        double addition = coeff * diff1[k-1][0];
        
        printf(" + (");
        for (int j = 0; j < k; j++) {
            printf("q");
            if (j > 0) printf("-%.0f", (double)j);
            if (j < k-1) printf("*");
        }
        printf(")/%d! * Δ^%dy0", k, k);
        
        printf("\n   = (%.3f)/%d! * %.6f", term, k, diff1[k-1][0]);
        printf(" = %.6f * %.6f", coeff, diff1[k-1][0]);
        printf(" = %.6f\n", addition);
        
        result += addition;
        printf("   Текущая сумма: %.6f\n", result);
        
        term *= (q - k);
    }
    
    printf("\nИтоговое значение: P(5) = %.6f\n", result);
    
    return 0;
}



Ключевые особенности для функции y = x⁴:
Точная интерполяция: Поскольку y = x⁴ - полином 4-й степени, а у нас 5 узлов (n=4), интерполяция должна быть точной.

Конечные разности: Четвертые разности постоянны (240), а пятые разности равны нулю, что характерно для полинома 4-й степени.

Нулевая погрешность: Для всех точек внутри и вне интервала интерполяции погрешность должна быть нулевой (с точностью до ошибок округления).

Экстраполяция: Даже за пределами узлов интерполяции формула Ньютона точно воспроизводит полином 4-й степени.



